#!/bin/bash

# === Task 5: Parallel Pokémon Data Fetching ===

POKEMON_LIST=("bulbasaur" "ivysaur" "venusaur" "charmander" "charmeleon")
OUTPUT_DIR="pokemon_data"
ERROR_LOG="errors.txt"

mkdir -p "$OUTPUT_DIR"
> "$ERROR_LOG"

fetch_pokemon() {
    name="$1"
    echo "Fetching data for $name..."

    response=$(curl -s -w "%{http_code}" -o "$OUTPUT_DIR/$name.json" "https://pokeapi.co/api/v2/pokemon/$name")
    status="${response:(-3)}"

    if [ "$status" -eq 200 ]; then
        echo "Saved data to $OUTPUT_DIR/$name.json ✅"
    else
        echo "[ERROR] Failed to fetch $name (HTTP $status)" >> "$ERROR_LOG"
        rm -f "$OUTPUT_DIR/$name.json"
    fi
}

# تشغيل كل طلب في الخلفية
for name in "${POKEMON_LIST[@]}"; do
    fetch_pokemon "$name" &
done

# انتظار جميع العمليات
wait

echo "✅ All Pokémon data fetched in parallel."
